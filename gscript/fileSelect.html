<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <style>
      table {
        width: 100%;
      }

      td {
        padding: 1rem;
      }

      .size {
        text-align: right;
      }

      .date {
        text-align: center;
      }
      .dialog h1 {
        display: none;
      }
      .working h1 {
        display: block;
        text-align: center;
      }
      .working table {
        display: none;
      }
    </style>
  </head>

  <body class="dialog">
    <h1>Procesando</h1>
    <table>
      <tr>
        <th>Nombre</th>
        <th>Tamaño (bytes)</th>
        <th>Fecha de creación</th>
      </tr>
      <? for (const file of listFiles()) { ?>
      <tr>
        <td>
          <a href="#<?= file.getId() ?>">
            <?= file.getName() ?>
          </a>
        </td>
        <td class="size">
          <?= file.getSize() ?>
        </td>
        <td class="date">
          <?= file.getDateCreated().toLocaleDateString() ?>
        </td>
      </tr>
      <? } ?>
    </table>
    <script>
      document.querySelectorAll('a').forEach((aEl) =>
        aEl.addEventListener('click', (ev) => {
          ev.preventDefault();
          document.body.className = 'working';
          google.script.run
            .withSuccessHandler(() => google.script.host.close())
            .procesarArchivo(
              ev.currentTarget.getAttribute('href').substring(1)
            );
        })
      );
    </script>
  </body>
</html>
